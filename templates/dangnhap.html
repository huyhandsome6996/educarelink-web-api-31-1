<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>ÄÄƒng nháº­p - EduCare Link</title>
</head>

<body>

<h2>ÄÄƒng nháº­p</h2>

<label>TÃªn Ä‘Äƒng nháº­p</label><br>
<input id="username" placeholder="Username"><br><br>

<label>Máº­t kháº©u</label><br>
<input id="password" type="password" placeholder="Password"><br><br>

<button onclick="loginUser()">ÄÄƒng nháº­p</button>

<p id="msg" style="color:red;"></p>

<hr>

<p>
    ChÆ°a cÃ³ tÃ i khoáº£n?
    <a href="/dangky/">ÄÄƒng kÃ½</a>
</p>

<hr>

<!-- ========================= -->
<!-- CAREPARTNER JOBS -->
<!-- ========================= -->

<h3 id="currentMode"></h3>

<div id="carepartnerSection" style="display:none;">
    <h3>ğŸ“¦ ÄÆ¡n chá» nháº­n</h3>
    <div id="joblist">Äang táº£i...</div>
</div>

<script>

//////////////////////////////
// LOGIN
//////////////////////////////
async function loginUser(){
    msg.innerText = "";

    const res = await fetch("/api/dangnhap/", {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify({
            username: username.value,
            password: password.value
        })
    });

    const data = await res.json();

    if(data.status === "ok"){
        window.location = "/dashboard/";
    } else {
        msg.innerText = "Sai tÃ i khoáº£n hoáº·c máº­t kháº©u";
    }
}

//////////////////////////////
// LOAD JOBS
//////////////////////////////
async function loadOpenJobs(){
    const res = await fetch("/api/jobs/open/");
    const data = await res.json();

    if(!data.data || data.data.length === 0){
        joblist.innerHTML = "KhÃ´ng cÃ³ Ä‘Æ¡n";
        return;
    }

    let html = "";

    data.data.forEach(j=>{
        html += `
        <div style="border:1px solid #ccc;margin:5px;padding:5px;">
            <b>Äá»‹a chá»‰:</b> ${j.dia_chi}<br>
            <b>Thá»i gian:</b> ${j.thoi_gian}<br>
            ${j.mo_ta}<br>
            <button onclick="nhan(${j.id})">Nháº­n Ä‘Æ¡n</button>
        </div>
        `;
    });

    joblist.innerHTML = html;
}

//////////////////////////////
// NHáº¬N ÄÆ N
//////////////////////////////
async function nhan(id){
    const res = await fetch("/api/booking/nhan/",{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({booking_id:id})
    });

    const data = await res.json();

    if(data.status === "ok"){
        alert("ÄÃ£ nháº­n Ä‘Æ¡n!");
        loadOpenJobs();
    }else{
        alert("KhÃ´ng nháº­n Ä‘Æ°á»£c Ä‘Æ¡n");
    }
}

//////////////////////////////
// LOAD MODE
//////////////////////////////
async function loadMode(){
    const res = await fetch("/api/mode/");
    const data = await res.json();

    if(data.login){

        currentMode.innerText =
            data.mode === "parent"
            ? "Cháº¿ Ä‘á»™: Phá»¥ huynh"
            : "Cháº¿ Ä‘á»™: Care Partner";

        if(data.mode === "carepartner"){
            carepartnerSection.style.display="block";
            loadOpenJobs();
        }else{
            carepartnerSection.style.display="none";
        }
    }
}

// Tá»± Ä‘á»™ng check mode khi má»Ÿ trang
loadMode();

</script>

</body>
</html>
